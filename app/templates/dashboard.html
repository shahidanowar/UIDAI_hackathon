{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="page-title">
                <!-- <span class="title-icon"></span> -->
                Aadhaar Data Intelligence
            </h1>
            <p class="page-subtitle">Real-time monitoring and validation of Aadhaar records across India</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="refreshBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                    <path d="M3 3v5h5" />
                    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
                    <path d="M16 16h5v5" />
                </svg>
                Refresh
            </button>
            <span class="last-updated">Last updated: <span id="lastUpdated">--</span></span>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card total-records">
            <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
            </div>
            <div class="card-content">
                <span class="card-value" id="totalRecords">--</span>
                <span class="card-label">Total Records</span>
            </div>
            <div class="card-trend up">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                </svg>
            </div>
        </div>

        <div class="summary-card anomalies">
            <div class="card-icon warning">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                    <line x1="12" y1="9" x2="12" y2="13" />
                    <line x1="12" y1="17" x2="12.01" y2="17" />
                </svg>
            </div>
            <div class="card-content">
                <span class="card-value" id="totalAnomalies">--</span>
                <span class="card-label">Anomalies Detected</span>
            </div>
            <div class="card-badge" id="anomalyRate">--%</div>
        </div>

        <div class="summary-card verified">
            <div class="card-icon success">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                    <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
            </div>
            <div class="card-content">
                <span class="card-value" id="verifiedFixed">--</span>
                <span class="card-label">Verified & Fixed</span>
            </div>
            <div class="card-progress">
                <div class="progress-bar" id="fixProgress"></div>
            </div>
        </div>

        <div class="summary-card pending">
            <div class="card-icon info">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                </svg>
            </div>
            <div class="card-content">
                <span class="card-value" id="pendingVerification">--</span>
                <span class="card-label">Pending Verification</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
        <!-- Map Section -->
        <div class="map-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" />
                        <line x1="8" y1="2" x2="8" y2="18" />
                        <line x1="16" y1="6" x2="16" y2="22" />
                    </svg>
                    India - State-wise Analysis
                </h2>
                <div class="map-legend">
                    <span class="legend-item low"><span class="legend-dot"></span>Low Risk</span>
                    <span class="legend-item medium"><span class="legend-dot"></span>Medium Risk</span>
                    <span class="legend-item high"><span class="legend-dot"></span>High Risk</span>
                </div>
            </div>
            <button class="btn btn-sm" id="backToIndiaBtn"
                style="display: none; position: absolute; top: 90px; right: 30px; z-index: 1000; background: #FFFFFF; border: 2px solid #000000; box-shadow: 2px 2px 0px #000000; font-weight: 600;">
                ‚Üê Back to India
            </button>
            <div id="indiaMap" class="india-map"></div>
        </div>

        <!-- State Details Panel -->
        <div class="state-panel" id="statePanel">
            <div class="panel-header">
                <h2 class="panel-title" id="stateName">Click a state to view details</h2>
                <button class="panel-close" id="closePanelBtn" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>

            <div class="panel-content" id="panelContent">
                <div class="panel-placeholder">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 16v-4" />
                        <path d="M12 8h.01" />
                    </svg>
                    <p>Select a state on the map to view detailed statistics and anomaly breakdown</p>
                </div>
            </div>

            <div class="panel-stats" id="stateStats" style="display: none;">
                <div class="stat-row">
                    <span class="stat-label">Total Records</span>
                    <span class="stat-value" id="stateRecords">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Anomalies</span>
                    <span class="stat-value" id="stateAnomalies">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Anomaly Rate</span>
                    <span class="stat-value" id="stateAnomalyRate">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Invalid PIN Rate</span>
                    <span class="stat-value" id="stateInvalidPin">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Duplicate Rate</span>
                    <span class="stat-value" id="stateDuplicate">--</span>
                </div>

                <div class="anomaly-breakdown">
                    <h3>Top Anomaly Types</h3>
                    <div class="anomaly-list" id="anomalyList"></div>
                </div>

                <div class="district-chart-container">
                    <h3>District Distribution</h3>
                    <canvas id="districtChart"></canvas>
                </div>

                <div class="panel-actions">
                    <a href="/prediction" class="btn btn-primary">Run Prediction</a>
                    <a href="/analysis" class="btn btn-secondary">View Analysis</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Most Affected States -->
    <div class="affected-states-section">
        <div class="section-header">
            <h2 class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                </svg>
                Most Affected States
            </h2>
        </div>
        <div class="affected-states-grid" id="affectedStates">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}